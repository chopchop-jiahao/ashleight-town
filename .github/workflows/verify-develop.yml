name: Verify Develop (Windows Only)

on:
  pull_request:
    branches: ['develop']

env:
  GODOT_VERSION: 4.5.1

jobs:
  setup:
    runs-on: macos-latest  # macOS runner 也能跑 Windows export
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Download Godot (macOS)
        run: |
          wget https://github.com/godotengine/godot-builds/releases/download/${GODOT_VERSION}-stable/Godot_v${GODOT_VERSION}-stable_macos.universal.zip -O godot-mac.zip
          unzip godot-mac.zip -d godot
          chmod +x godot/Godot.app/Contents/MacOS/Godot
        shell: bash

      - name: Download and install Godot export templates
        run: |
          wget https://github.com/godotengine/godot-builds/releases/download/${GODOT_VERSION}-stable/Godot_v${GODOT_VERSION}-stable_export_templates.tpz -O export_templates.tpz
          mkdir -p "$HOME/Library/Application Support/Godot/export_templates"
          unzip export_templates.tpz -d "$HOME/Library/Application Support/Godot/export_templates/${GODOT_VERSION}.stable"
        shell: bash

      - name: Set Godot executable
        run: echo "GODOT_EXE=$(pwd)/godot/Godot.app/Contents/MacOS/Godot" >> $GITHUB_ENV

      - name: Build Windows executable
        run: |
          mkdir -p build/windows
          ${{ env.GODOT_EXE }} --no-window \
            --export-release "ashleigh-town-windows" \
            build/windows/Ashleigh-Town.exe
